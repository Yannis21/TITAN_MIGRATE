//DDB-FileStart
//DDB-HeaderStart

// File Name : GARTICL.DD
// Class Name: Garticl_DataDictionary
// Revision  : 135
// Version   : 2

Use  Windows           // Basic Definitions
Use  DataDict          // DataDictionary Class Definition
Use  DDvalTbl          // Validation Table Class Definitions

Open Garticl
Open Gmove
Open Gmovea
Open Gtypkin
Open Gthaa
Open Sysrecg
Open Gbridgeh
Open Gbridged
Open Barticl
Open Particle

//DDB-HeaderEnd
//DDB-ValidationStart

Register_Object Garticl_Garticl_A_Code_VT
Register_Object Garticl_Garticl_C_Code2_VT
Register_Object Garticl_Garticl_Statuse_VT
Register_Object Garticl_Garticl_M_Code_VT

Object Garticl_Garticl_A_Code_VT  is a CodeValidationTable
    Set Type_Value        To "AITIOL"
    Set Validate_State    To FALSE
    Set Allow_Blank_State To TRUE
    //DDB-ValidationCustomStart
    //DDB-ValidationCustomEnd
End_Object   // Garticl_Garticl_A_Code_VT

Object Garticl_Garticl_C_Code2_VT  is a CodeValidationTable
    Set Type_Value        To "CURRENCY"
    Set Allow_Blank_State To TRUE
    //DDB-ValidationCustomStart
    //DDB-ValidationCustomEnd
End_Object   // Garticl_Garticl_C_Code2_VT

Object Garticl_Garticl_Statuse_VT  is a DescriptionValidationTable

    Procedure Fill_List
        Forward Send Fill_List
        Send Add_Table_Value  "0"  "è®¶©‡®†§„"
        Send Add_Table_Value  "1"  "Ñ§û£ú®‡£‚§û"
        Send Add_Table_Value  "-1"  "ãú®†°„"
    End_Procedure    // Fill_List
    //DDB-ValidationCustomStart
    //DDB-ValidationCustomEnd
End_Object   // Garticl_Garticl_Statuse_VT

Object Garticl_Garticl_M_Code_VT  is a CodeValidationTable
    Set Type_Value        To "MODULE"
    Set Allow_Blank_State To TRUE
    //DDB-ValidationCustomStart
    //DDB-ValidationCustomEnd
End_Object   // Garticl_Garticl_M_Code_VT
//DDB-ValidationEnd
//DDB-SelectionStart
//DDB/ ExternalSelectionList Garticl  Garticl.SL
Register_Object Garticl
//DDB-SelectionEnd
Open Rates

Register_Object oDo_Change_Garticl
//Use Docnggar.bp

Use Gmovea.dd //Æ®ú†·ùú´ò† ¶ß‡õ„ß¶´ú, õ†Ê´† úÂ§ò† alias file °ò†
              //©´û§ begin_transaction ß®¶°ò¢úÂ deadlock

Class Garticl_DataDictionary  is a DataDictionary_Sec
 
      //private
      //°ò¢úÂ´ò† òß¶ ´û§ request_save °ò† £ûõú§Âùú† Ê¢ò ´ò properties
      Procedure private.Initialize_Properties
                 //£ûõú§†©£Ê™ ßò¢ò†È§
                 Set psB_Gtypkin_Recr    to ''
                 Set pdB_Garticl_Hmnia   to 0
                 Set piB_Garticl_No      to 0
                 Set psB_Garticl_C_Code2 to ""
                 Set pnB_Garticl_Rate0   to 0
                 Set pnB_Garticl_Rate00  to 0
                 Set pnB_Garticl_RateR   to 0
                 Set piB_Garticl_Aa      to 0

                 //£ûõú§†©£Ê™ §‚‡§
                 Set psA_Gtypkin_Recr    to ''
                 Set pdA_Garticl_Hmnia   to 0
                 Set piA_Garticl_No      to 0
                 Set psA_Garticl_C_Code2 to ""
                 Set pnA_Garticl_Rate0   to 0
                 Set pnA_Garticl_Rate00  to 0
                 Set pnA_Garticl_RateR   to 0
                 Set piA_Garticl_Aa      to 0

                 //properties ö†ò ´¶§ ‚¢úöÆ¶ ´¶¨ òò
                 Set pnA_Garticl_SX2     to 0
                 Set pnA_Garticl_SP2     to 0
                 Set pnA_Garticl_SX0     to 0
                 Set pnA_Garticl_SP0     to 0
                 Set pnA_Garticl_SX00    to 0
                 Set pnA_Garticl_SP00    to 0
                 Set pnA_Garticl_SXR     to 0
                 Set pnA_Garticl_SPR     to 0
                 Set pnA_Garticl_SX1     to 0
                 Set pnA_Garticl_SP1     to 0

                 Set pnB_Garticl_SX2     to 0
                 Set pnB_Garticl_SP2     to 0
                 Set pnB_Garticl_SX0     to 0
                 Set pnB_Garticl_SP0     to 0
                 Set pnB_Garticl_SX00    to 0
                 Set pnB_Garticl_SP00    to 0
                 Set pnB_Garticl_SXR     to 0
                 Set pnB_Garticl_SPR     to 0
                 Set pnB_Garticl_SX1     to 0
                 Set pnB_Garticl_SP1     to 0

      End_Procedure //private.Initialize_Properties


    //private
    //°ò¢úÂ´ò† òß¶ ´û§ update °ò† ©ú´·®ú† hard-coded to garticl_statuse
    // ö†ò §ò üú‡®ûüúÂ ‚§ò ·®ü®¶ ‚ö°¨®¶ ß®¶©‡®†§Ê, ß®‚ßú†
    // 1. §ò ‚Æú† Ê¢ò ´¶¨ ´ò ¨ßÊ¢¶†ßò °ò† ©´ò 4 §¶£Â©£ò´ò £ûõú§†°·
    // Garticl.Garticl_Syp0  = 0 and
    // Garticl.Garticl_Syp00 = 0 and
    // Garticl.Garticl_Sypr  = 0 and
    // Garticl.Garticl_Syp2  = 0
    // 2. §ò ‚Æú† ´¶¨¢·Æ†©´¶§ 1 ö®ò££„ Æ®‚‡©û™ °ò† 1 ö®ò££„ ßÂ©´‡©û™
    // Garticl.Garticl_Xreline >= 1 and
    // Garticl.Garticl_Pisline >= 1
    // 3. §ò ‚Æú† ´¶¨¢·Æ†©´¶§ 2 gmoves (ò¨´Ê £·¢¢¶§ úÂ§ò† ß¢ú¶§ò©£Ê™)
    // Garticl.Garticl_Mlines >= 2
    // Ñ·§ ‚©´‡ °ò† £Âò òß¶ ´†™ ßò®òß·§‡ 3 ©¨§ü„°ú™ õ‚§ †©ÆÁú†, ´Ê´ú
    // ´¶ ·®ü®¶ üú‡®úÂ´ò† under construction °ò† ‚Æú† statuse=(-1)
    //
    // ÑßÂ©û™, ú·§ °ò† ¶† 3 ßò®òß·§‡ ©¨§ü„°ú™ †©ÆÁ¶¨§ (¶ßÊ´ú ‚Æ‡ statuse=0,
    // ´Ê´ú:
    // ap) Ñ·§ flag 06 (ò¨•·§ú† ãìî è‡¢„©ú‡§ (+ß¢„ü¶™)
    //     ap.1. è®‚ßú† §ò ‚Æú† ´¶§ ò®†ü£Ê 1 ©´¶     Garticl_MyfNump and
    //     ap.2. è®‚ßú† §ò ‚Æú† valid Gplan_Code ©´¶ Garticl_MyfCodp and
    //     ap.3. è®‚ßú† §ò ‚Æú† ´¶§ ò®†£Ê 1 ©´¶      Garticl_MyfChkp
    // bp) Ñ·§ flag 07 (ò¨•·§ú† ãìî è‡¢„©ú‡§ (+ò•Âò)
    //     bp.1. è®‚ßú† §ò ‚Æú† üú´†°„ ´†£„  ©´¶     Garticl_MyfValp and
    //     bp.2. è®‚ßú† §ò ‚Æú† valid Gplan_Code ©´¶ Garticl_MyfCodp and
    //     bp.3. è®‚ßú† §ò ‚Æú† ´¶§ ò®†£Ê 1 ©´¶      Garticl_MyfChkp
    // cp) Ñ·§ flag 08 (£ú†È§ú† ãìî è‡¢„©ú‡§ (-ß¢„ü¶™)
    //     cp.1. è®‚ßú† §ò ‚Æú† ´¶§ ò®†ü£Ê (-1) ©´¶  Garticl_MyfNump and
    //     cp.2. è®‚ßú† §ò ‚Æú† valid Gplan_Code ©´¶ Garticl_MyfCodp and
    //     cp.3. è®‚ßú† §ò ‚Æú† ´¶§ ò®†£Ê 1 ©´¶      Garticl_MyfChkp
    // dp) Ñ·§ flag 09 (£ú†È§ú† ãìî è‡¢„©ú‡§ (-ò•Âò)
    //     dp.1. è®‚ßú† §ò ‚Æú† ò®§û´†°„ ´†£„  ©´¶   Garticl_MyfValp and
    //     dp.2. è®‚ßú† §ò ‚Æú† valid Gplan_Code ©´¶ Garticl_MyfCodp and
    //     dp.3. è®‚ßú† §ò ‚Æú† ´¶§ ò®†£Ê 1 ©´¶      Garticl_MyfChkp
    // èò®Ê£¶†ú™ ©¨§ü„°ú™ †©ÆÁ¶¨§ °ò† ö†ò ´û§ ãìî òö¶®È§ (aa ba ca da)
    //ú·§ ´¶ ·®ü®¶ úÂ§ò† ‚ö°¨®¶ ß®¶©‡®†§· °ò† ‚Æú† òò > 0 , ´Ê´ú úÂ§ò† ‚ö°¨®¶ ú§û£ú®‡£‚§¶
    Function private.fiCurrent_Garticl_Status Returns Integer

             //************************************************************
             //*        Ñ ä Ñ Ç ï é ë    ì è é ä é à è ó å                *
             //************************************************************

             //‚¢úöÆ¶™ ©¨§ü„°û™ 1 (ß®¶©¶Æ„ ©´ò ¨ßÊ¢¶†ßò ¢Êö‡ †©¶´†£Âò™!!!!
             //                    õ‚§ £ûõú§Âù¶¨§, ú·§ õ‚§ ´®‚•ú† û check_Arthro_for_ypoloipo
             If (Not(;
                 (Garticl.Garticl_Syp0  = 0) and;
                 (Garticl.Garticl_Syp00 = 0) and;
                 (Garticl.Garticl_Sypr  = 0) and;
                 (Garticl.Garticl_Syp2  = 0);
                )) Function_Return (-1)

             //‚¢úöÆ¶™ ©¨§ü„°û™ 2
             If (Not(;
                 (Garticl.Garticl_Xreline >= 1) and;
                 (Garticl.Garticl_Pisline >= 1);
                )) Function_Return (-1)

             //‚¢úöÆ¶™ ©¨§ü„°û™ 3
             If (Not(;
                 (Garticl.Garticl_Mlines >= 2);
                )) Function_Return (-1)

             //************************************************************
             //*        ã ì î    è ó ä Ü ë Ñ ó å                          *
             //************************************************************
             //‚¢úöÆ¶™ ©¨§ü„°û™ ap {flag 06:ò¨•·§ú† ãìî è‡¢„©ú‡§ (+ß¢„ü¶™)}
             If (Gtypkin.Gtypkin_Flag06 = TRUE);
             Begin
                  If (Not(;
                      (Garticl.Garticl_Myfnump  = 1 )   and;
                      (Garticl.Garticl_MyfCodp <> "") and;
                      (Garticl.Garticl_Myfchkp  = 1 );
                     )) Function_Return (-1)
             End

             //‚¢úöÆ¶™ ©¨§ü„°û™ bp {(flag 07:ò¨•·§ú† ãìî è‡¢„©ú‡§ (+ò•Âò)}
             If (Gtypkin.Gtypkin_Flag07 = TRUE);
             Begin
                  If (Not(;
                      (Garticl.Garticl_MyfValp  > 0 ) and;
                      (Garticl.Garticl_MyfCodp <> "") and;
                      (Garticl.Garticl_Myfchkp  = 1 );
                     )) Function_Return (-1)
             End

             //‚¢úöÆ¶™ ©¨§ü„°û™ cp {flag 08:£ú†È§ú† ãìî è‡¢„©ú‡§ (-ß¢„ü¶™)}
             If (Gtypkin.Gtypkin_Flag08 = TRUE);
             Begin
                  If (Not(;
                      (Garticl.Garticl_Myfnump  = (-1)) and;
                      (Garticl.Garticl_MyfCodp <>  "" ) and;
                      (Garticl.Garticl_Myfchkp  =   1 );
                     )) Function_Return (-1)
             End

             //‚¢úöÆ¶™ ©¨§ü„°û™ dp {(flag 07:£ú†È§ú† ãìî è‡¢„©ú‡§ (-ò•Âò)}
             If (Gtypkin.Gtypkin_Flag09 = TRUE);
             Begin
                  If (Not(;
                      (Garticl.Garticl_MyfValp <  0 ) and;
                      (Garticl.Garticl_MyfCodp <> "") and;
                      (Garticl.Garticl_Myfchkp  = 1 );
                     )) Function_Return (-1)
             End

             //************************************************************
             //*        ã ì î    Ä Ç é ê ó å                              *
             //************************************************************
             //‚¢úöÆ¶™ ©¨§ü„°û™ aa {flag 10:ò¨•·§ú† ãìî Äö¶®È§ (+ß¢„ü¶™)}
             If (Gtypkin.Gtypkin_Flag10 = TRUE);
             Begin
                  If (Not(;
                      (Garticl.Garticl_Myfnuma  = 1 )   and;
                      (Garticl.Garticl_MyfCoda <> "") and;
                      (Garticl.Garticl_Myfchka  = 1 );
                     )) Function_Return (-1)
             End

             //‚¢úöÆ¶™ ©¨§ü„°û™ ba {(flag 11:ò¨•·§ú† ãìî Äö¶®È§ (+ò•Âò)}
             If (Gtypkin.Gtypkin_Flag11 = TRUE);
             Begin
                  If (Not(;
                      (Garticl.Garticl_MyfVala  > 0 ) and;
                      (Garticl.Garticl_MyfCoda <> "") and;
                      (Garticl.Garticl_Myfchka  = 1 );
                     )) Function_Return (-1)
             End

             //‚¢úöÆ¶™ ©¨§ü„°û™ ca {flag 12:£ú†È§ú† ãìî Äö¶®È§ (-ß¢„ü¶™)}
             If (Gtypkin.Gtypkin_Flag12 = TRUE);
             Begin
                  If (Not(;
                      (Garticl.Garticl_Myfnuma  = (-1)) and;
                      (Garticl.Garticl_MyfCoda <>  "" ) and;
                      (Garticl.Garticl_Myfchka  =   1 );
                     )) Function_Return (-1)
             End

             //‚¢úöÆ¶™ ©¨§ü„°û™ da {(flag 13:£ú†È§ú† ãìî Äö¶®È§ (-ò•Âò)}
             If (Gtypkin.Gtypkin_Flag13 = TRUE);
             Begin
                  If (Not(;
                      (Garticl.Garticl_MyfVala <  0 ) and;
                      (Garticl.Garticl_MyfCoda <> "") and;
                      (Garticl.Garticl_Myfchka  = 1 );
                     )) Function_Return (-1)
             End

             //ú·§ úÂ§ò† Ê¢ò ok °ò† ´¶ garticl úÂ§ò† ¶®†©´†°¶ß¶†û£‚§¶,
             //´Ê´ú statuse = 1
             If (Garticl.Garticl_Aa > 0) Function_Return 1 //valid ú§û£ú®‡£‚§û
             Else                        Function_Return 0 //valid ß®¶©‡®†§„
    End_Function //private.ficurrent_garticl_status


      //private
      //ô®Â©°ú† ú·§ úß†´®‚ßú´ò† û ´®¶ß¶ß¶Âû©û (edit) ´¶¨ ´®‚Æ¶§´¶™ Gmove record
      //©ú ©¨§·®´û©û £ú ´¶§ ò/ò ´¶¨ ·®ü®¶¨.
      //°ò¢úÂ´ò† òßÊ validate_save, °ò† ¢ú†´¶¨®öúÂ £ú ´û§ ú•„™ ¢¶ö†°„:
      //1.Ê¢ò ´ò §‚ò Gmove ß®‚ßú† §ò ‚Æ¶¨ òò=0
      //2.£Ê§¶§ ¶† bp's Do_Cascade_Update
      //                xorigise_aa           (limode=1)
      //                zero_aa               (limode=2)
      //£ß¶®¶Á§ §ò ò¢¢·•¶¨§ ´¶§ òò
      //©ú Ê¢ú™ ´†™ ·¢¢ú™ ßú®†ß´È©ú†™, ú·§ òò>0 òßòö¶®úÁú´ò† ´¶ edit ´‡§ °®Â©†£‡§ ßúõÂ‡§

      Function private.fiCheck_Garticl_Aa Returns Integer
               Integer  liCurrent_Record liCheck
               Integer  lbAll_Critical_Fields_Are_Not_Changed
               Integer  lbAll_Computed_Fields_Are_Not_Changed

               Integer  liMode

               String   lsB_Gtypkin_Recr     lsA_Gtypkin_Recr
               Date     ldB_Garticl_Hmnia    ldA_Garticl_Hmnia
               Integer  liB_Garticl_No       liA_Garticl_No
               String   lsB_Garticl_C_Code2  lsA_Garticl_C_Code2
               Number   lnB_Garticl_Rate0    lnA_Garticl_Rate0
               Number   lnB_Garticl_Rate00   lnA_Garticl_Rate00
               Number   lnB_Garticl_RateR    lnA_Garticl_RateR
               Integer  liB_Garticl_Aa       liA_Garticl_Aa

               Number   lnB_Garticl_SX2      lnA_Garticl_SX2
               Number   lnB_Garticl_SP2      lnA_Garticl_SP2
               Number   lnB_Garticl_SX0      lnA_Garticl_SX0
               Number   lnB_Garticl_SP0      lnA_Garticl_SP0
               Number   lnB_Garticl_SX00     lnA_Garticl_SX00
               Number   lnB_Garticl_SP00     lnA_Garticl_SP00
               Number   lnB_Garticl_SXR      lnA_Garticl_SXR
               Number   lnB_Garticl_SPR      lnA_Garticl_SPR
               Number   lnB_Garticl_SX1      lnA_Garticl_SX1
               Number   lnB_Garticl_SP1      lnA_Garticl_SP1

               Get piMode to liMode

               //‚¢úöÆ¶™ ú·§ õû£†¶¨®öÈ §‚¶ record
               Get Current_Record to liCurrent_Record
               If (liCurrent_Record = 0);
               Begin //õû£†¶¨®öÂò §‚¶¨ garticl £Ê§¶§ £ú limode=0 °ò† òò=0
                 If (liMode             <> 0) Function_Return 1 //not valid
                 If (Garticl.Garticl_Aa <> 0) Function_Return 1 //not valid
                 Else                         Function_Return 0 //valid
               End

               //ò§·ö§‡©û ßò¢ò†È§ ´†£È§
               Get psB_Gtypkin_Recr     to lsB_Gtypkin_Recr
               Get pdB_Garticl_Hmnia    to ldB_Garticl_Hmnia
               Get piB_Garticl_No       to liB_Garticl_No
               Get psB_Garticl_C_Code2  to lsB_Garticl_C_Code2
               Get pnB_Garticl_Rate0    to lnB_Garticl_Rate0
               Get pnB_Garticl_Rate00   to lnB_Garticl_Rate00
               Get pnB_Garticl_RateR    to lnB_Garticl_RateR
               Get piB_Garticl_Aa       to liB_Garticl_Aa

               Get pnB_Garticl_SX2      to lnB_Garticl_SX2
               Get pnB_Garticl_SP2      to lnB_Garticl_SP2
               Get pnB_Garticl_SX0      to lnB_Garticl_SX0
               Get pnB_Garticl_SP0      to lnB_Garticl_SP0
               Get pnB_Garticl_SX00     to lnB_Garticl_SX00
               Get pnB_Garticl_SP00     to lnB_Garticl_SP00
               Get pnB_Garticl_SXR      to lnB_Garticl_SXR
               Get pnB_Garticl_SPR      to lnB_Garticl_SPR
               Get pnB_Garticl_SX1      to lnB_Garticl_SX1
               Get pnB_Garticl_SP1      to lnB_Garticl_SP1

               //ò§·ö§‡©û §‚‡§ ´†£È§
               Get psA_Gtypkin_Recr     to lsA_Gtypkin_Recr
               Get pdA_Garticl_Hmnia    to ldA_Garticl_Hmnia
               Get piA_Garticl_No       to liA_Garticl_No
               Get psA_Garticl_C_Code2  to lsA_Garticl_C_Code2
               Get pnA_Garticl_Rate0    to lnA_Garticl_Rate0
               Get pnA_Garticl_Rate00   to lnA_Garticl_Rate00
               Get pnA_Garticl_RateR    to lnA_Garticl_RateR
               Get piA_Garticl_Aa       to liA_Garticl_Aa

               Get pnA_Garticl_SX2      to lnA_Garticl_SX2
               Get pnA_Garticl_SP2      to lnA_Garticl_SP2
               Get pnA_Garticl_SX0      to lnA_Garticl_SX0
               Get pnA_Garticl_SP0      to lnA_Garticl_SP0
               Get pnA_Garticl_SX00     to lnA_Garticl_SX00
               Get pnA_Garticl_SP00     to lnA_Garticl_SP00
               Get pnA_Garticl_SXR      to lnA_Garticl_SXR
               Get pnA_Garticl_SPR      to lnA_Garticl_SPR
               Get pnA_Garticl_SX1      to lnA_Garticl_SX1
               Get pnA_Garticl_SP1      to lnA_Garticl_SP1

               //ú·§ Ê¢ú™ ¶† ßò®·£ú´®¶† before+after úÂ§ò† Â©ú™,
               //´Ê´ú òß¶õ‚Æ¶£ò† ´¶ validation
               Move (;
                     (lsB_Gtypkin_Recr   = lsA_Gtypkin_Recr   ) and;
                     (ldB_Garticl_Hmnia  = ldA_Garticl_Hmnia  ) and;
                     (liB_Garticl_No     = liA_Garticl_No     ) and;
                     (lsB_Garticl_C_Code2= lsA_Garticl_C_Code2) and;
                     (lnB_Garticl_Rate0  = lnA_Garticl_Rate0  ) and;
                     (lnB_Garticl_Rate00 = lnA_Garticl_Rate00 ) and;
                     (lnB_Garticl_RateR  = lnA_Garticl_RateR  )    ;
                    ) to lbAll_Critical_Fields_Are_Not_Changed

               Move (;
                     (lnB_Garticl_SX2    = lnA_Garticl_SX2    ) and;
                     (lnB_Garticl_SP2    = lnA_Garticl_SP2    ) and;
                     (lnB_Garticl_SX0    = lnA_Garticl_SX0    ) and;
                     (lnB_Garticl_SP0    = lnA_Garticl_SP0    ) and;
                     (lnB_Garticl_SX00   = lnA_Garticl_SX00   ) and;
                     (lnB_Garticl_SP00   = lnA_Garticl_SP00   ) and;
                     (lnB_Garticl_SXR    = lnA_Garticl_SXR    ) and;
                     (lnB_Garticl_SPR    = lnA_Garticl_SPR    )    ;
                    ) to lbAll_Computed_Fields_Are_Not_Changed

               Case Begin
                    Case (liMode = 0) //normal operation (edit)
                         If (;
                              (liB_Garticl_Aa = 0) and;
                              (liA_Garticl_Aa = 0)    ;
                            )  Function_Return 0 //valid
                         If (;
                             (lbAll_Critical_Fields_Are_Not_Changed = TRUE          ) and;
                             (lbAll_Computed_Fields_Are_Not_Changed = TRUE          ) and;
                             (liB_Garticl_Aa                        = liA_Garticl_Aa)    ;
                             ) Function_Return 0 //valid
                         Else  Function_Return 1 //not valid
                    Case Break

                    Case (liMode = 1) //Æ¶®„öû©û ò/ò
                         Function_Return 0 //14/02/2000  1
                         If (;
                             (lbAll_Critical_Fields_Are_Not_Changed = TRUE) and;
                             (lbAll_Computed_Fields_Are_Not_Changed = TRUE) and;
                             (liB_Garticl_Aa                        = 0   ) and;
                             (liA_Garticl_Aa                        > 0   )    ;
                             ) Function_Return 0 //valid
                         Else  Function_Return 1 //not valid
                         //  (lnB_Garticl_SX1                       = 0   ) and;
                         //  (lnA_Garticl_SX1                      <> 0   ) and;
                         //  (lnB_Garticl_SP1                       = 0   ) and;
                         //  (lnA_Garticl_SP1                      <> 0   )    ;
                    Case Break

                    Case (liMode = 2) //£ûõú§†©£Ê™ ò/ò
                         Function_Return 0 //14/02/2000 1
                         If (;
                             (lbAll_Critical_Fields_Are_Not_Changed = TRUE) and;
                             (lbAll_Computed_Fields_Are_Not_Changed = TRUE) and;
                             (liB_Garticl_Aa                        > 0   ) and;
                             (liA_Garticl_Aa                        = 0   )    ;
                             ) Function_Return 0 //valid
                         Else  Function_Return 1 //not valid
                         //  (lnB_Garticl_SX1                      <> 0   ) and;
                         //  (lnA_Garticl_SX1                       = 0   ) and;
                         //  (lnB_Garticl_SP1                      <> 0   ) and;
                         //  (lnA_Garticl_SP1                       = 0   )    ;
                    Case Break
               Case End


               Function_Return 1 //not valid
      End_Function //private.fiGarticl_Aa


    //private
    //ô®Â©°ú† ö†ò ´¶ ©¨ö°ú°®†£‚§¶ üú‡®û£‚§¶ û£ú®¶¢Êö†¶,
    //´û§ ´ú¢ú¨´òÂò û£ú®¶£û§Âò Æ¶®„öû©û™ Ä/Ä.
    //ú·§ õ‚§ ¨ß·®Æú† ´‚´¶†ò û£ú®¶£û§Âò, úß†©´®‚≠ú† ´û§ ß®È´û û£ú®¶£û§Âò ´û™ Æ®„©ú‡™
    //°ò¢úÂ´ò† òßÊ:1. validate_save
    //             2. private.Xorigise_Aa ´û™ bp oDo_GL_Maintainance (doGlMntn.bp)
    Function private.fdGthaa_Last_Hmnia Integer liGthHmgio_Code Returns Date
             Clear GthAA
             Move SyscurGL.Company_Code to Gthaa.Company_Code
             Move SyscurGL.Branch_Code  to Gthaa.Branch_Code
             Move SyscurGL.Year_Year    to Gthaa.Year_Year
             Move liGthHmgio_Code       to Gthaa.GthHmgio_Code
             Find Eq Gthaa By Index.1 //company_code+branch_code+year_year+gthhmgio_code
             If (Found =1);
                  Begin //‚Æú† õ¶üúÂ ß®¶ûö¶¨£‚§‡™ òò
                   Function_Return Gthaa.Gthaa_Lhmnia
                  End
             Else Begin //õ‚§ ‚Æú† õ¶üúÂ òò
                    Function_Return SyscurGL.Year_XrhshFrom
                  End
    End_Function //private.fdgthaa_last_hmnia

    //private
    //ô®Â©°ú† ö†ò ´¶ ©¨ö°ú°®†£‚§¶ üú‡®û£‚§¶ û£ú®¶¢Êö†¶,
    //´¶§ ´ú¢ú¨´òÂ¶ ò®†ü£Ê Ä/Ä.
    //ú·§ õ‚§ ¨ß·®Æú† ´‚´¶†¶™, úß†©´®‚≠ú† 0
    //°ò¢úÂ´ò† òßÊ:1. validate_save
    //             2. private.Xorigise_Aa ´û™ bp oDo_GL_Maintainance (doGlMntn.bp)
    Function private.fiGthaa_Last_Aa Integer liGthHmgio_Code Returns Integer
             Clear GthAA
             Move SyscurGL.Company_Code to Gthaa.Company_Code
             Move SyscurGL.Branch_Code  to Gthaa.Branch_Code
             Move SyscurGL.Year_Year    to Gthaa.Year_Year
             Move liGthHmgio_Code       to Gthaa.GthHmgio_Code
             Find Eq Gthaa By Index.1 //company_code+branch_code+year_year+gthhmgio_code
             If (Found =1);
                  Begin //‚Æú† õ¶üúÂ ß®¶ûö¶¨£‚§‡™ òò
                   Function_Return Gthaa.Gthaa_Laa
                  End
             Else Begin //õ‚§ ‚Æú† õ¶üúÂ òò
                    Function_Return 0
                  End
    End_Function //private.fdgthaa_last_aa


    //private
    //ô®Â©°ú† ö†ò ´¶ ©¨ö°ú°®†£‚§¶ §Ê£†©£ò & û£/§Âò úöö®ò≠„™
    //´¶ ò§´Â©´¶†Æ¶ record ´¶¨ rates °ò† ©ú´·®ú† ´ò 3 properties.
    //ú·§ õ‚§ ¨ß·®Æú† record †©¶´†£†È§, ©ú´·®ú† ´ò properties ©ú -1.
    //û function ò¨´„, °·§ú† 2 õ¶¨¢ú†‚™:
    //ò) ô®Â©°ú† ´û§ †©¶´†£Âò 0 ö†ò ´û§ £ú´ò´®¶ß„ ´¶¨ §¶£Â©£ò´¶™ úöö®ò≠„™
    //   ©ú °Á®†¶ §Ê£†©£ò Æ®„©û™, ©ú´·®¶§´ò™ ò§´Â©´¶†Æò ´¶ pnA_Garticl_Rate0,
    // °ò†
    //ô) ô®Â©°ú† ´†™ †©¶´†£Âú™ 00 °ò† r ö†ò ´û§ £ú´ò´®¶ß„ ´¶¨ §¶£Â©£ò´¶™ úöö®ò≠„™
    //   ©ú õú¨´ú®úÁ¶§ §Ê£†©£ò Æ®„©û™ °ò† §Ê£†©£ò reporting,
    //   ©ú´·®¶§´ò™ ò§´Â©´¶†Æò ´ò pnA_Garticl_Rate00 °ò† pnA_Garticl_Rater,
    //   ·©Æú´ò £ú ´ò flags 3 °ò† 4.

    //****************************************************************************
    //p r o s o x i   sta rates 2->00 kai 2->r kai 2->0 !!!!!!                   *
    //****************************************************************************

    //°ò¢úÂ´ò† òß¶ ´û§ update
    Procedure private.Find_Rates String lsCurrency_C_Code;
                                 Date   ldRates_Hmnia

              If (lsCurrency_C_Code = "");
              Begin //õ‚§ ‚Æú† ¶®†©üúÂ §Ê£†©£ò úöö®ò≠„™ °ò† õ‚§ £ß¶®È §ò ô®È †©¶´†£Âú™
               Set pnA_Garticl_Rate0  to (-1)
               Set pnA_Garticl_Rate00 to (-1)
               Set pnA_Garticl_RateR  to (-1)
               Procedure_Return
              End

              If (lsCurrency_C_Code = Year.Year_C_Code0);
              Begin //´¶ §Ê£†©£ò úöö®ò≠„™ †©¶Á´ò† £ú ´¶ °Á®†¶ §Ê£†©£ò Æ®„©û™
               Set pnA_Garticl_Rate0  to 1
               //Set pnA_Garticl_Rate00 to 1
               //Set pnA_Garticl_RateR  to 1
               //Procedure_Return               sosososo ! ! ! !
              End

              //If (ldRates_Hmnia = 0);
              //Begin //õ‚§ ‚Æú† ¶®†©üúÂ û£ú®¶£û§Âò úöö®ò≠„™ °ò† õ‚§ £ß¶®È §ò ô®È †©¶´†£Âú™??????
              // Set pnA_Garticl_Rate0  to (-1)
              // Set pnA_Garticl_Rate00 to (-1)
              // Set pnA_Garticl_RateR  to (-1)
              // Procedure_Return
              //End


              Clear Rates
              Move lsCurrency_C_Code to Rates.Currency_C_Code
              Move ldRAtes_Hmnia     to Rates.Rates_Hmnia
              Find Eq Rates by Index.1 //currency_c_code+rates_hnmnia
              If (Found = 1) Begin
                              Set pnA_Garticl_Rate0  to Rates.Rates_Rate0
                              Set pnA_Garticl_Rate00 to Rates.Rates_Rate00
                              Set pnA_Garticl_RateR  to Rates.Rates_RateR
                             End
              Else           Begin
                              Set pnA_Garticl_Rate0  to (-1)
                              Set pnA_Garticl_Rate00 to (-1)
                              Set pnA_Garticl_RateR  to (-1)

                             End
    End_Procedure //private.find_rates


    Procedure Construct_Object
              Forward Send Construct_Object

              Property String  psA_Gtypkin_Recr     ''
              Property Date    pdA_Garticl_Hmnia    0
              Property Integer piA_Garticl_No       0
              Property String  psA_Garticl_C_Code2  ""
              Property Number  pnA_Garticl_Rate0    0
              Property Number  pnA_Garticl_Rate00   0
              Property Number  pnA_Garticl_RateR    0
              Property Integer piA_Garticl_Aa       0

              Property String  psB_Gtypkin_Recr     ''
              Property Date    pdB_Garticl_Hmnia    0
              Property Integer piB_Garticl_No       0
              Property String  psB_Garticl_C_Code2  ""
              Property Number  pnB_Garticl_Rate0    0
              Property Number  pnB_Garticl_Rate00   0
              Property Number  pnB_Garticl_RateR    0
              Property Integer piB_Garticl_Aa       0

              Property Integer piDo_Change_Garticl  0 //object id ´û™ business process
                                                      //ß¶¨ ò¢¢·ùú† ´ò 8 ßúõÂò ©´¶ Gmove

              //-----------------------------------------properties ö†ò ´¶§ ‚¢úöÆ¶ ´¶¨ òò
              Property Integer piMode               0  // 0 : regular data entry operation
                                                       // 1 : Æ¶®„öû©û ò/ò
                                                       // 2 : £ûõú§†©£Ê™ ò/ò

              Property Number  pnB_Garticl_SX2      0  //X2          2:§¶£†©£ò úöö®ò≠„™
              Property Number  pnB_Garticl_SP2      0  //P2
              Property Number  pnB_Garticl_SX0      0  //x0          0:°Á®†¶ §Ê£†©£ò Æ®„©û™
              Property Number  pnB_Garticl_SP0      0  //p0
              Property Number  pnB_Garticl_SX00     0  //x00         00:õú¨´ú®úÁ¶§ §Ê£†©£ò Æ®„©û™
              Property Number  pnB_Garticl_SP00     0  //p00
              Property Number  pnB_Garticl_SXR      0  //xr          r:§Ê£†©£ò reporting
              Property Number  pnB_Garticl_SPR      0  //pr
              Property Number  pnB_Garticl_SX1      0  //X1          0:°Á®†¶ §Ê£†©£ò Æ®„©û™ ¶®†©´†°¶ß¶†û£‚§ò
              Property Number  pnB_Garticl_SP1      0  //P1

              Property Number  pnA_Garticl_SX2      0  //X2          2:§¶£†©£ò úöö®ò≠„™
              Property Number  pnA_Garticl_SP2      0  //P2
              Property Number  pnA_Garticl_SX0      0  //x0          0:°Á®†¶ §Ê£†©£ò Æ®„©û™
              Property Number  pnA_Garticl_SP0      0  //p0
              Property Number  pnA_Garticl_SX00     0  //x00         00:õú¨´ú®úÁ¶§ §Ê£†©£ò Æ®„©û™
              Property Number  pnA_Garticl_SP00     0  //p00
              Property Number  pnA_Garticl_SXR      0  //xr          r:§Ê£†©£ò reporting
              Property Number  pnA_Garticl_SPR      0  //pr
              Property Number  pnA_Garticl_SX1      0  //X1          0:°Á®†¶ §Ê£†©£ò Æ®„©û™ ¶®†©´†°¶ß¶†û£‚§ò
              Property Number  pnA_Garticl_SP1      0  //P1


              Property Integer piButton_id          0  //ö†ò §ò £¶¨ õúÂÆ§ú† û cascade update
                                                       //´ò gmove recnums
              //-----------------------------------------properties ö†ò ´¶§ ‚¢úöÆ¶ ´¶¨ òò

              Property Integer piMustNotConstrain Public 0

              Property Integer piDoNotValidateMe  Public 0
    End_Procedure   //construct_object


    Procedure End_Construct_Object
              Forward Send End_Construct_Object
              Set piDo_Change_Garticl to (oDo_Change_Garticl(Self))
              Send Remove_Client_File Gmovea.File_Number
    End_Procedure   //end_construct_object


    Procedure OnConstrain
        Forward Send OnConstrain
        If (piMustNOTConstrain(Self)) Begin
        End
        Else Begin
            Constrain Garticl.Company_Code  eq SysCurGL.Company_Code
            Constrain Garticl.Branch_Code   eq SysCurGL.Branch_Code
            Constrain Garticl.Year_Year     eq SysCurGL.Year_Year
        End
    End_Procedure

    //ò) ú§û£‚®‡©û £„ related ßúõÂ‡§
    //ô) ò§·ö§‡©û properties
    //ö) õ†òÆúÂ®†©û calculated ßúõÂ‡§
    //õ) ú§û£‚®‡©û òü®¶†©´È§ (adjust_balances)
    //ú) ú§û£‚®‡©û properties after
    Procedure Update
              Number lnIsotimia## lnIsotimia1##
              Forward Send Update

              //ò) ú§û£‚®‡©û £„ related ßúõÂ‡§
              Move SyscurGL.Company_Code  to Garticl.Company_Code
              Move SyscurGL.Branch_Code   to Garticl.Branch_Code
              Move SyscurGL.Year_Year     to Garticl.Year_Year
              Move Gtypkin.Gtypkin_Code   to Garticl.Gtypkin_Code

              Move Gthhmgio.Gthhmgio_Code to Garticl.Gthhmgio_Code

              //ô) ò§·ö§‡©û properties

              //ö) õ†òÆúÂ®†©û calculated ßúõÂ‡§ 01:garticl_hmnia
              //                                02:garticl_rate0
              //                                03:garticl_rate00
              //                                04:garticl_rater
              //                                05:garticl_c_code2
              //                                06:garticl_MyfNump
              //                                07:garticl_MyfNuma
              //                                08:garticl_statuse

              //ö.01:õ†òÆúÂ®†©û û£ú®¶£û§Âò™
              If (Gthhmgio.Gthhmgio_Period <> 0);
              Begin //£„ °ò§¶§†°‚™ ßú®Â¶õ¶†
               If (Gthhmgio.Gthhmgio_Period < 0);
                    Move SysCurGL.Year_XrhshFrom to Garticl.Garticl_Hmnia //ßú®Â¶õ¶† òß¶ö®ò≠„™
               Else Move SysCurGL.Year_XrhshTo   to Garticl.Garticl_Hmnia //ßú®Â¶õ¶† †©¶¢¶ö†©£¶Á
              End

              //£‚©‡ ´‡§ flags 2 3 4 6 8 10 12, õ†òÆú†®†ùÊ£ò©´ú ´ò ßò®ò°·´‡
              //calculated ßúõÂò:
              //ö.02:õ†òÆúÂ®†©û rate0  °ò†
              //ö.03:õ†òÆúÂ®†©û rate00 °ò†
              //ö.04:õ†òÆúÂ®†©û rater  °ò†
              //ö.05:õ†òÆúÂ®†©û c_code_2
              //ö.06:garticl_MyfNump
              //ö.07:garticl_MyfNuma

              //************************************************************************
              //flag 2:ò•Âú™ 2 ©ú •‚§¶ §Ê£†©£ò                                         *
              //************************************************************************
              //´¶ garticl ß®‚ßú† ¶ß‡©ß„ß¶´ú §ò ‚Æú† §Ê£†©£ò °ò† rate0 !
              //ú·§ û °Â§û©û úß†´®‚ßú† ò•Âú™ ©ú •‚§¶ §Ê£†©£ò, ´Ê´ú:
              //       ò) ú·§ ¶ user õÈ©ú† °ò®≠‡´Ê rate, ´Ê´ú †©ÆÁú† ò¨´Ê,
              //          ò¢¢¶†È™, ú·§ ¶ user õÈ©ú† 0 rate, ´¶ ô®Â©°¶¨£ú (ú·§ ¨ß·®Æú†) òß¶ ´¶Á™ ß†§ò°ú™ †©¶´†£†È§,
              //          °ò† ©ú´·®¶¨£ú ´ò ·¢¢ò 2 rates.
              //       ô) ú·§ ¶ user õÈ©ú† °ò®≠‡´Ê §Ê£†©£ò úöö®ò≠„™, ´Ê´ú †©ÆÁú† ò¨´Ê,
              //          ò¢¢¶†È™ ©ú´·®¶¨£ú by default ©ú year_c_code0, °ò† òß¶ ßÂ§ò°ú™ †©¶´†£†È§
              //          ©ú´·®¶¨£ú ´ò ·¢¢ò 2 rates.
              If (Gtypkin.Gtypkin_Flag02= TRUE );
                   Begin //úÁ®ú©û rate £ú´ò´®¶ß„™ ò•Âò™ 2 -> 0
                    If (Garticl.Garticl_C_Code2= "" ) Move Year.Year_C_Code0 to Garticl.Garticl_C_Code2
                    Send private.Find_Rates Garticl.Garticl_C_Code2 Garticl.Garticl_Hmnia
                    If (Garticl.Garticl_Rate0  = 0  ) Get pnA_Garticl_Rate0  to Garticl.Garticl_Rate0
                   End
              //ú·§ û °Â§û©û õ‚§ úß†´®‚ßú† ò•Âú™ ©ú •‚§¶ §Ê£†©£ò, ´Ê´ú
              //       ©ú´·®¶¨£ú ´¶ rate0 ©ú 1 °ò† ´¶ c_code2 ©ú year_c_code0
              Else Begin //ò•Âú™ £Ê§¶§ ©ú °Á®†¶ §Ê£†©£ò Æ®„©û™
                    Move Year.Year_C_Code0 to Garticl.Garticl_C_Code2
                    Move 1                 to Garticl.Garticl_Rate0
                    Send private.Find_Rates Garticl.Garticl_C_Code2 Garticl.Garticl_Hmnia
                   End

              //************************************************************************
              //flag 3:£ú´ò´®¶ß„ ò•†È§ ©ú õú¨´ú®úÁ¶§ §Ê£†©£ò Æ®„©û™                    *
              //************************************************************************
              //‚Æú† „õû ´®‚•ú† û private.Find_Rates, °ò† úõÈ òß¢È™ ´©†£ß·£ú ´ò rates,
              //´ò ¶ß¶Âò ´ò ‚Æ¶¨£ú „õû ‚´¶†£ò !
              If (Gtypkin.Gtypkin_Flag03 = TRUE);
                   Begin //ò§·ö§‡©û rate £ú´ò´®¶ß„™ ò•Âò™ 2 -> 00
                    If (Garticl.Garticl_Rate00 = 0  ) Get pnA_Garticl_Rate00 to Garticl.Garticl_Rate00
                   End
              Else Begin //¶† ò•Âú™ õ‚§ £ú´ò´®‚ß¶§´ò† ©ú õú¨´ú®úÁ¶§ §Ê£†©£ò Æ®„©û™
                    Move 0 to Garticl.Garticl_Rate00
                    Set pnA_Garticl_Rate00 to 0
                   End

              //************************************************************************
              //flag 4:£ú´ò´®¶ß„ ò•†È§ ©ú §Ê£†©£ò reporting                            *
              //************************************************************************
              //‚Æú† „õû ´®‚•ú† û private.Find_Rates, °ò† úõÈ òß¢È™ ´©†£ß·£ú ´ò rates,
              //´ò ¶ß¶Âò ´ò ‚Æ¶¨£ú „õû ‚´¶†£ò !
              If (Gtypkin.Gtypkin_Flag04 = TRUE);
                   Begin //ò§·ö§‡©û rate £ú´ò´®¶ß„™ ò•Âò™ 2 -> R
                    If (Garticl.Garticl_RateR  = 0  ) Get pnA_Garticl_RateR  to Garticl.Garticl_RateR
                   End
              Else Begin //¶† ò•Âú™ õ‚§ £ú´ò´®‚ß¶§´ò† ©ú §Ê£†©£ò reporting
                    Move 0 to Garticl.Garticl_RateR
                    Set pnA_Garticl_RateR  to 0
                   End



              //*********************************************************
              //flag 6:ò¨•·§ú† ãìî ß‡¢„©ú‡§ (+ß¢„ü¶™)                   *
              //*********************************************************
              If (Gtypkin.Gtypkin_Flag06 = TRUE);
                   Begin
                    Move 1 to Garticl.Garticl_MyfNump //sos ÊÆ† ö†ò õ¶®ü‡´†°‚™ ãìî !
                   End



//sososo §ò ú¢úöüúÂ ¶ °Èõ†°ò™ ö†ò ´¶ myfnump+a ! ! ! ! ! ! !
              //*********************************************************
              //flag 8:£ú†È§ú† ãìî ß‡¢„©ú‡§ (-ß¢„ü¶™)                   *
              //*********************************************************
     Else     If (Gtypkin.Gtypkin_Flag08 = TRUE);
                   Begin
                    Move (-1) to Garticl.Garticl_MyfNump
                   End
     Else           Move 0 to Garticl.Garticl_MyfNump //sos ÊÆ† ö†ò õ¶®ü‡´†°‚™ ãìî !



              //*********************************************************
              //flag 10:ò¨•·§ú† ãìî òö¶®È§ (+ß¢„ü¶™)                    *
              //*********************************************************
              If (Gtypkin.Gtypkin_Flag10 = TRUE);
                   Begin
                    Move 1 to Garticl.Garticl_MyfNuma
                   End

              //*********************************************************
              //flag 12:£ú†È§ú† ãìî òö¶®È§ (-ß¢„ü¶™)                    *
              //*********************************************************
     Else     If (Gtypkin.Gtypkin_Flag12 = TRUE);
                   Begin
                    Move (-1) to Garticl.Garticl_MyfNuma
                   End
     Else           Move   0  to Garticl.Garticl_MyfNuma



              //ö.08:õ†òÆúÂ®†©û statuse
              Move (private.fiCurrent_Garticl_Status(Self)) to Garticl.Garticl_Statuse


              //õ) ú§û£‚®‡©û òü®¶†©´È§ (adjust_balances)

              //ú) ú§û£‚®‡©û properties after (òßÊ parent buffers!)
              Set psA_Gtypkin_Recr    to Gtypkin.Gtypkin_Recr
              Set pdA_Garticl_Hmnia   to Garticl.Garticl_Hmnia
              Set piA_Garticl_No      to Garticl.Garticl_No
              Set psA_Garticl_C_Code2 to Garticl.Garticl_C_Code2
              Set pnA_Garticl_Rate0   to Garticl.Garticl_Rate0
              Set pnA_Garticl_Rate00  to Garticl.Garticl_Rate00
              Set pnA_Garticl_RateR   to Garticl.Garticl_RateR
              Set piA_Garticl_Aa      to Garticl.Garticl_Aa

              //properties ö†ò ´¶§ ‚¢úöÆ¶ ´¶¨ òò
              Set pnA_Garticl_SX2     to Garticl.Garticl_SX2
              Set pnA_Garticl_SP2     to Garticl.Garticl_SP2
              Set pnA_Garticl_SX0     to Garticl.Garticl_SX0
              Set pnA_Garticl_SP0     to Garticl.Garticl_SP0
              Set pnA_Garticl_SX00    to Garticl.Garticl_SX00
              Set pnA_Garticl_SP00    to Garticl.Garticl_SP00
              Set pnA_Garticl_SXR     to Garticl.Garticl_SXR
              Set pnA_Garticl_SPR     to Garticl.Garticl_SPR
              Set pnA_Garticl_SX1     to Garticl.Garticl_SX1
              Set pnA_Garticl_SP1     to Garticl.Garticl_SP1

    End_Procedure   //update


    Procedure Backout
              Forward Send Backout

              //ú) ú§û£‚®‡©û properties before (òßÊ current buffer)
              Set psB_Gtypkin_Recr    to Garticl.Gtypkin_Recr
              Set pdB_Garticl_Hmnia   to Garticl.Garticl_Hmnia
              Set piB_Garticl_No      to Garticl.Garticl_No
              Set psB_Garticl_C_Code2 to Garticl.Garticl_C_Code2
              Set pnB_Garticl_Rate0   to Garticl.Garticl_Rate0
              Set pnB_Garticl_Rate00  to Garticl.Garticl_Rate00
              Set pnB_Garticl_RateR   to Garticl.Garticl_RateR
              Set piB_Garticl_Aa      to Garticl.Garticl_Aa

              //properties ö†ò ´¶§ ‚¢úöÆ¶ ´¶¨ òò
              Set pnB_Garticl_SX2     to Garticl.Garticl_SX2
              Set pnB_Garticl_SP2     to Garticl.Garticl_SP2
              Set pnB_Garticl_SX0     to Garticl.Garticl_SX0
              Set pnB_Garticl_SP0     to Garticl.Garticl_SP0
              Set pnB_Garticl_SX00    to Garticl.Garticl_SX00
              Set pnB_Garticl_SP00    to Garticl.Garticl_SP00
              Set pnB_Garticl_SXR     to Garticl.Garticl_SXR
              Set pnB_Garticl_SPR     to Garticl.Garticl_SPR
              Set pnB_Garticl_SX1     to Garticl.Garticl_SX1
              Set pnB_Garticl_SP1     to Garticl.Garticl_SP1
    End_Procedure   // backout


    Procedure Creating
            Forward Send Creating

            Move (Append('',((Trim(SysCurGL.Branch_Site))+;
                             (Trim(String(Garticl.Garticl_Rec0)))))) to Garticl.Garticl_Recr

              //Add 1 to Year.Year_NumGarticl //ò®†ü£Ê™ ·®ü®‡§ ´û™ Æ®„©û™
              If (piDoNotValidateMe(Self)=0);
                  Move gs_Module_Code to Garticl.Garticl_M_Code //module úöö®ò≠„™

              //************************************************************************
              //flag 5:ò¨´Ê£ò´û ò®Âü£û©û                                               *
              //************************************************************************
              If (Gtypkin.Gtypkin_Flag05 = TRUE);
                   Begin //´¶ ·®ü®¶ ‚Æú† ò¨´Ê£ò´û ò®Âü£û©û
                    Add 1 to Gtypkin.Gtypkin_L_No
                    Move Gtypkin.Gtypkin_L_No to Garticl.Garticl_No
                   End
              Else Begin //´¶ ·®ü®¶ ‚Æú† Æú†®¶°Â§û´û ò®Âü£û©û
                   End
    End_Procedure //creating


    Procedure Deleting
              Forward Send Deleting
              //Sub 1 from Year.Year_NumGarticl //ò®†ü£Ê™ ·®ü®‡§ ´û™ Æ®„©û™
    End_Procedure //deleting


    Procedure Save_Main_File
              Forward Send Save_Main_File

              //ú§û£‚®‡©û gthaa, ú·§ ´¶ garticl úÂ§ò† ¶®†©´†°¶ß¶†û£‚§¶
              If (Garticl.Garticl_Aa > 0);
              Begin
                  Clear GthAA
                  Move SysCurGL.Company_Code    to Gthaa.Company_Code
                  Move SysCurGL.Branch_Code     to Gthaa.Branch_Code
                  Move SysCurGL.Year_Year       to Gthaa.Year_Year
                  Move Gthhmgio.GthHmgio_Code   to Gthaa.GthHmgio_Code
                  Find Eq Gthaa By Index.1 //company_code+branch_code+year_year+gthhmgio_code
                  If (Found=0);
                  Begin //õû£†¶¨®öÂò §‚¶¨ record ghthaa
                       Add 1 to SysrecG.Gthaa_Rec0
                       Saverecord SysrecG
                       Move SysrecG.Gthaa_Rec0      to Gthaa.Gthaa_Rec0
                       Move (Append('',((Trim(SysCurGL.Branch_Site))+;
                                        (Trim(String(Gthaa.Gthaa_Rec0)))))) to Gthaa.Gthaa_Recr

                       //ú§û£‚®‡©û related ßúõÂ¶¨
                       Move Gthhmgio.Gthhmgio_Recr to Gthaa.Gthhmgio_Recr
                       Move SysCurGL.Year_Recr     to Gthaa.Year_Recr
                  End //´‚¢¶™ õû£†¶¨®öÂòs §‚¶¨ record gthaa

                  Move (Garticl.Garticl_Hmnia Max Gthaa.Gthaa_Lhmnia) to Gthaa.Gthaa_Lhmnia
                  Move (Garticl.Garticl_Aa    Max Gthaa.Gthaa_Laa   ) to Gthaa.Gthaa_Laa
                  Saverecord Gthaa
              End
    End_Procedure//save_main_file

    Procedure Operation_Not_Allowed Integer iError_Num
              String lsError_Message
              Date   ldGthaa_Hmnia
              Case Begin
                   //òßÊ validate save
                   Case (iError_Num = 1001)
                        Move ("DDC 156:Ä°ò´·¢¢û¢û Ü£ú®¶£û§Âò !\n\nã†°®Ê´ú®û ´û™ ú§·®•ú‡™ Æ®„©ú‡™ ("+;
                        (String(Year.Year_XrhshFrom))+")") to lsError_Message
                        Case Break
                   Case (iError_Num = 1002)
                        Move ("DDC 156:Ä°ò´·¢¢û¢û Ü£ú®¶£û§Âò !\n\nãúöò¢Á´ú®û ´û™ ¢„•ú‡™ Æ®„©ú‡™ ("+;
                        (String(Year.Year_XrhshTo))+")") to lsError_Message
                        Case Break
                   Case (iError_Num = 1003)
                        Move (private.fdGthaa_Last_Hmnia(Self,GthHmgio.GthHmgio_Code)) to ldGthaa_Hmnia
                        Move ("DDC 156:Ä°ò´·¢¢û¢û Ü£ú®¶£û§Âò !\n\nã†°®Ê´ú®û/Â©û ´û™ ´ú¢ú¨´òÂò™ û£ú®¶£û§Âò™ Æ¶®„öû©û™\n\nÄ/Ä ©´¶ üú‡®û£‚§¶ û£ú®¶¢Êö†¶ ("+;
                        (String(ldGthaa_Hmnia))+")") to lsError_Message
                        Case Break
                   Case (iError_Num = 1004)
                        Move ("DDC 156:Ä°ò´·¢¢û¢û Ñöö®ò≠„ (rate1) !\n\nÉ‚§ ‚Æú† ¶®†©üúÂ †©¶´†£Âò £ú´ò´®¶ß„™ ©ú °Á®†¶ §Ê£†©£ò Æ®„©ú‡™ !");
                        to lsError_Message
                        Case Break
                   Case (iError_Num = 1005)
                        Move ("DDC 156:Ä°ò´·¢¢û¢û Ñöö®ò≠„ (rate2) !\n\nÉ‚§ ‚Æú† ¶®†©üúÂ †©¶´†£Âò £ú´ò´®¶ß„™ ©ú õú¨´ú®‚¨¶§ §Ê£†©£ò Æ®„©ú‡™ !");
                        to lsError_Message
                        Case Break
                   Case (iError_Num = 1006)
                        Move ("DDC 156:Ä°ò´·¢¢û¢û Ñöö®ò≠„ (rate3) !\n\nÉ‚§ ‚Æú† ¶®†©üúÂ †©¶´†£Âò £ú´ò´®¶ß„™ ©ú §Ê£†©£ò reporting !");
                        to lsError_Message
                        Case Break
                   Case (iError_Num = 1007)
                        Move ("DDC 156:Ä°ò´·¢¢û¢û Ñöö®ò≠„ !\n\nãûõú§†°Ê™ ò®†ü£Ê™ ßò®ò©´ò´†°¶Á !");
                        to lsError_Message
                        Case Break
                   Case (iError_Num = 1008)
                        Move ("DDC 156:ÄõÁ§ò´û û ´®¶ß¶ß¶Âû©û !\n\nÏ úöö®ò≠„ úÂ§ò† ¶®†©´†°„ !");
                        to lsError_Message
                        Case Break
                   Case (iError_Num = 1009)
                        Clear Codemast
                        Move "MODULE" to Codemast.Type
                        Move Garticl.Garticl_M_Code to Codemast.Code
                        Find Eq Codemast by Index.1 //type+code
                        Move ("DDC 156:ÄõÁ§ò´û û Ñöö®ò≠„\n\n(í¶ ·®ü®¶ ´®¶ß¶ß¶†úÂ´ò† £Ê§¶§ òßÊ "+;
                        (Trim(Codemast.Description))+" )") to lsError_Message
                        Case Break
                   Case (iError_Num = 1010)
                        Move ("DDC 156:ÄõÁ§ò´û û Ñöö®ò≠„\n\n(É‚§ ‚Æú† ¶®†©üúÂ §Ê£†©£ò !)");
                        to lsError_Message
                        Case Break
                   Case (iError_Num = 1011)
                        Move ("DDC 156:ÄõÁ§ò´û û Ñöö®ò≠„\n\n(É‚§ ‚Æú† ¶®†©üúÂ module !)");
                        to lsError_Message
                        Case Break
                   Case (iError_Num = 1012)
                        Move ("DDC 156:ÄõÁ§ò´û û Ñöö®ò≠„\n\n(É‚§ ‚Æú† ¶®†©üúÂ delimiter ö†ò ´û§ ´®‚Æ¶¨©ò Æ®„©û !)");
                        to lsError_Message
                        Case Break
                   Case (iError_Num = 1100)
                        Move "DDC 156:ãû òß¶õú°´„ Ñ´ò†®Âò-ï®„©û" to lsError_Message
                        Case Break

                   //òßÊ validate delete
                   Case (iError_Num = 2001)
                        Move ("DDC 156:ÄõÁ§ò´û û õ†òö®ò≠„!\n\ní¶ ·®ü®¶ ‚Æú† ¶®†©´†°¶ß¶†ûüúÂ (Ä/Ä= "+;
                        (String(Garticl.Garticl_AA))+" )") to lsError_Message
                        Case Break
                   Case (iError_Num = 2002)
                        Clear Codemast
                        Move "MODULE" to Codemast.Type
                        Move Garticl.Garticl_M_Code to Codemast.Code
                        Find Eq Codemast by Index.1 //type+code
                        Move ("DDC 156:ÄõÁ§ò´û û õ†òö®ò≠„!\n\n(í¶ ·®ü®¶ õ†òö®·≠ú´ò† £Ê§¶§ òßÊ "+;
                        (Trim(Codemast.Description))+" )") to lsError_Message
                        Case Break
                   Case (iError_Num = 2100)
                        Move "DDC 059:ãû òß¶õú°´„ Ñ´ò†®Âò-ï®„©û"  to lsError_Message
                        Case Break

                   Case Else
                        Forward Send Operation_Not_Allowed iError_Num
              Case End

              Error iError_Num lsError_Message
    End_Procedure // operation_not_allowed

    Procedure Shmera integer iField  Date dDate
        Local Integer Changed
        Get Field_Changed_State iField to Changed
        If (Changed=0 AND dDate =0) Begin
            SysDate4 dDate
            Set Field_Default_Value iField to dDate
        End
    End_Procedure   // Shmera
    //1001:gartcl_hmnia >= year_xrhsh From
    //1002:gartcl_hmnia <= year_xrhsh To
    //1003:gartcl_hmnia >  gthaa_lhmnia

    //????:gartcl_aa    >= gthaa_laa


    //1004:gartcl_rate0 > 0
    //1005:If flag03 then garticl_rate0 > 0
    //1006:If flag04 then garticl_rateR > 0
    //1007:garticl_no > 0

    //1008:garticl_aa = 0:úß†´®‚ßú´ò† save £Ê§¶§ ©ú ß®¶©‡®†§‚™ °†§„©ú†™-´ò ¶®†©´†°· ·®ü®ò õ‚§ ò¢¶†È§¶§´ò†
    //                   (ß®¶©¶Æ„ ©´û§ Æ¶®„©û©û òò : ß®È´ò ©Èù‡ Gmove °ò† £ú´· garticl!)
    //                   ß†üò§Ê§ ¶ ‚¢úöÆ¶™ ò¨´Ê™ §ò öÂ§ú† £ú ´¶ statuse
    //                   ´ú¢†°·, ¶ ‚¢úöÆ¶™ ò¨´Ê™ öÂ§ú´ò† £ú ´û§ pibgarticl_aa

    //1009:m_code:û úöö®ò≠„ úß†´®‚ßú´ò† £Ê§¶§ òß¶ ¶ module ß¶¨ ´û§ õû£†¶Á®öû©ú
    //1010:´¶ c_code2 ß†·§ú´ò† òß¶ ´¶ validation table (no blanks allowed!)
    //     õ¨©´¨ÆÈ™, ¢Êö‡ ´¶¨ öúö¶§Ê´¶™ Ê´† ß®È´ò ´®‚Æú† ´¶ validation ´¶¨ deo,
    //     ¨ß¶Æ®úÊ§¶£ò† §ò ô·ù‡ blaks allowed, °ò† §ò validaro úõÈ,
    //     õ†Ê´† ´®‚Æ¶¨§ °ò† bp's Æ‡®Â™ deo's.
    //1011:m_code (ö†ò ´¶¨™ Âõ†¶¨™ ¢Êö¶¨™ ´¶¨ c_code_2
    //1012:year_delimiter <> ""
    //1013:aa >= gthaa if aa>0  !!!!!!!
    //1100:cby = globals

    //period (fixed date)????
    //????:garticl_hmnia <= year_entry_date
    //     :flag


    Function Validate_Save Returns Integer
             Integer iReturnVal liGthaa_Last_Aa
             Date    ldGthaa_Last_Hmnia

             Forward Get Validate_Save to iReturnVal

             If (Not(iReturnVal));
             Begin
              //úÁ®ú©û ´ú¢ú¨´òÂò™ û£ú®¶£û§Âò™ Æ¶®„öû©û™ ò/ò ©´¶ üú‡®û£‚§¶ û£ú®¶¢Êö†¶
              Move (private.fdGthaa_Last_Hmnia(Self,GthHmgio.GthHmgio_Code)) to ldGthaa_Last_Hmnia
              //èêéëéïÜ ! ò¨´Ê õ‚§ ú¢‚öÆú´ò† !
              //úÁ®ú©û ´ú¢ú¨´òÂ¶¨ ò®†ü£¶Á ò/ò ©´¶ üú‡®û£‚§¶ û£ú®¶¢Êö†¶
              Move (private.fiGthaa_Last_Aa   (Self,GthHmgio.GthHmgio_Code)) to liGthaa_Last_Aa

              // 10/05/2002
              // Gia na mhn xtypaei h BP doEnhmGL sthn request_save
              // dioti gia kapoio logo pou den exoume akoma brei
              // erxetai edo me thn hmeromhnia kenh

              If (piDoNotValidateMe(Self)=0) Begin
                  //1001+1002+1003:‚¢úöÆ¶† û£ú®¶£û§Âò™
                  If (Not(Garticl.Garticl_Hmnia >= SysCurGL.Year_XrhshFrom )) Send Operation_Not_Allowed 1001
                  If (Not(Garticl.Garticl_Hmnia <= SysCurGL.Year_XrhshTo   )) Send Operation_Not_Allowed 1002

                //sosososososo!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
                //ß®‚ßú† §ò £ßúÂ > °ò† ÊÆ† >=, õ†Ê´† ‚Æú† ß®Êô¢û£ò û ®¶¨´Â§ò òò
                //pimode=1 ö†ò ´û§ Æ¶®„öû©û òò
                //pimode=2 ö†ò ´¶§ £ûõú§†©£Ê òò
                //´¶ pimode ‚Æú† ´†™ ú•„™ ´†£‚™ : 0 : regular data entry operation
                //                                1 : Æ¶®„öû©û ò/ò
                //                                2 : £ûõú§†©£Ê™ ò/ò

                  If (((piMode(Self)) = 0) and (liGthaa_Last_Aa<>0));
                  Begin //regular data entry, ‚¢úöÆ¶™ û£/§Âò™ ¢¶ö†©´†°¶ß¶Âû©û™
                       If (Not(Garticl.Garticl_Hmnia >   ldGthaa_Last_Hmnia  )) Send Operation_Not_Allowed 1003
                  End

                  Else;
                  If ((piMode(Self)) = 1);
                  Begin //Æ¶®„öû©û ò/ò
                       If (Not(Garticl.Garticl_Hmnia >=  ldGthaa_Last_Hmnia  )) Send Operation_Not_Allowed 1003
                  End

                  Else;
                  If ((piMode(Self)) = 2);
                  Begin //£ûõú§†©£Ê™ ò/ò
                       If (Not(Garticl.Garticl_Hmnia <=  ldGthaa_Last_Hmnia  )) Send Operation_Not_Allowed 1003
                  End

    //              Else;
    //              If ((piMode(Self)) = 0);
    //              Begin //regular data entry
    //                   //1009:‚¢úöÆ¶™ module úöö®ò≠„™
    //                   If (Not(Garticl.Garticl_M_Code = gs_Module_Code))       Send Operation_Not_Allowed 1009
    //              End
    ////sosososososo!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

              End


              //1004:‚¢úöÆ¶™ †©¶´†£Âò™ 0 //sosososo §ò ú¢úöüúÂ û ¢¶ö†°„
              If (Not(Garticl.Garticl_Rate0  >  0                  )) Send Operation_Not_Allowed 1004
              //1004:‚¢úöÆ¶™ †©¶´†£Âò™ 00
              If ((Gtypkin.Gtypkin_Flag03 = TRUE) and;
              (Not(Garticl.Garticl_Rate00 > 0));
                 )                                                    Send Operation_Not_Allowed 1005
              //1005:‚¢úöÆ¶™ †©¶´†£Âò™ r
              If ((Gtypkin.Gtypkin_Flag04 = TRUE) and;
              (Not(Garticl.Garticl_RateR  > 0));
                 )                                                    Send Operation_Not_Allowed 1006

              //1007:‚¢úöÆ¶™ ò®†ü£¶Á ßò®ò©´ò´†°¶Á
              If (Not(Garticl.Garticl_No     >  0                  )) Send Operation_Not_Allowed 1007

              //1008:‚¢úöÆ¶™ ò/ò (¢¶ö†©´†°¶ß¶Âû©û™)
              If (Not((private.fiCheck_Garticl_Aa(Self)) = 0))        Send Operation_Not_Allowed 1008

//‚≠¨öú òßÊ úõÈ, õ†Ê´† úÂÆú ß®Êô¢û£ò û ®¶¨´Â§ò Æ¶®„öû©û™-£ûõú§†©£¶Á ò/ò
//----------> //1009:‚¢úöÆ¶™ module úöö®ò≠„™
//----------> If (Not(Garticl.Garticl_M_Code = gs_Module_Code))       Send Operation_Not_Allowed 1009

              //1010:‚¢úöÆ¶™ £„ °ú§¶Á §¶£Â©£ò´¶™
              If (Not(Garticl.Garticl_C_Code2 <> ""          ))       move syscurgl.c_code0 to Garticl.Garticl_C_Code2

              //1011:‚¢úöÆ¶™ £„ °ú§¶Á module úöö®ò≠„™
              If (Not(Garticl.Garticl_M_Code <> ""           ))       Send Operation_Not_Allowed 1011

              //1012:‚¢úöÆ¶™ £„ °ú§¶Á year_delimiter
        //      If (Not(Year.Year_Delimiter <> ""              ))       Send Operation_Not_Allowed 1012

              //1100:cby = globals
              If ( ;
                  (Not(Garticl.Company_Code = gs_Selected_Company_Code)) or;
                  (Not(Garticl.Branch_Code  = gs_Selected_Branch_Code )) or;
                  (Not(Garticl.Year_Year    = gi_Selected_Year        ));
                  )                                                   Send Operation_Not_Allowed 1100

              //‚¢úöÆ¶™ û£ú®¶£û§Âò™ ú®öò©Âò™
              //If (Not(Garticl.Garticl_Hmnia <= Year.Year_Entry_Date)) Send Operation_Not_Allowed 999

             End //´‚¢¶™ °Èõ†°ò validation
             Function_Return iReturnVal
    End_Function   // validate_save


    //2001:´ò ¶®†©´†°¶ß¶†û£‚§ò ·®ü®ò õ‚§ õ†òö®·≠¶§´ò†
    //2002:´¶ ·®ü®¶ õ†òö®·≠ú´ò† £Ê§¶§ òß¶ ´¶ module ß¶¨ ´¶ õû£†¶Á®öû©ú
    //2100:cby = globals
    Function Validate_Delete  Returns Integer
             Integer iReturnVal
             Forward Get Validate_Delete  To iReturnVal
             If (Not(iReturnVal));
             Begin
             //2001:‚¢úöÆ¶™ ò/ò (¢¶ö†©´†°¶ß¶Âû©û™)
              If (Garticl.Garticl_AA > 0                      )       Send Operation_Not_Allowed 2001

              //2002:‚¢úöÆ¶™ module úöö®ò≠„™ 13/05/02 removed from georg
              //If (Not(Garticl.Garticl_M_Code = gs_Module_Code))       Send Operation_Not_Allowed 2002

              //2100:cby = globals
              If ( ;
                   (Not(Garticl.Company_Code = SysCurGL.Company_Code)) or;
                   (Not(Garticl.Branch_Code  = SysCurGL.Branch_Code )) or;
                   (Not(Garticl.Year_Year    = SysCurGL.Year_Year   ));
                  )                                                   Send Operation_Not_Allowed 2100
             End //´‚¢¶™ °Èõ†°ò validation
             Function_Return iReturnVal
    End_Function   // Validate_Delete

     Procedure Request_Save
               Integer liDo_Change_Garticl liTrexe_Result

               //***************
               BEGIN_TRANSACTION
               //***************
               Set Smart_Filemode_State to False
               Forward Send Request_Save
               Set Smart_Filemode_State to True

               If (Not(Err));
                    Begin //ú≠'Ê©¶§ ´¶ garticl record ©Èüû°ú °ò§¶§†°·, ß®¶Æ‡®·‡ ©´û§ bpo
                     Get piDo_Change_Garticl to liDo_Change_Garticl
                     Get Trexe of liDo_Change_Garticl (Self) to liTrexe_Result

                     If (liTrexe_Result <> 0);
                        Begin //ú≠'Ê©¶§ û bpo õ‚§ ‚´®ú•ú ©‡©´·, ò°¨®È§‡ ´¶ transaction
                         //***************
                         ABORT_TRANSACTION
                         //***************
                         //£ûõú§†©£Ê™ properties ö†ò úßÊ£ú§û °Â§û©û
                         Send private.Initialize_Properties
                         Indicate Err False
                         Procedure_Return
                        End
                     //úßò§ò≠¶®· ´¶¨ system indicator err
                     Indicate Err False
                    End

               Else Begin //ú≠'Ê©¶§ ´¶ Gmove record õ‚§ ©Èüû°ú, ò°¨®È§‡ ´¶ transaction
                     //***************
                     ABORT_TRANSACTION
                     //***************
                     Send private.Initialize_Properties
                     Indicate Err False
                     Procedure_Return
                    End

             //ú≠'Ê©¶§ °ò† ´¶ garticl record ©Èüû°ú °ò§¶§†°·,
             //°ò† û bpo ‚´®ú•ú Æ‡®Â™ error,  °ò´òÆ‡®È ´¶ transaction
             //***************
             END_TRANSACTION
             //***************
             //£ûõú§†©£Ê™ properties ö†ò úßÊ£ú§û °Â§û©û
             Send private.Initialize_Properties
             //úßò§ò≠¶®· ´¶¨ system indicator err
             //?????Indicate Err False
    End_Procedure   // Request_Save


     //°ò¢úÂ´ò† òß¶ ·¢¢ò modules £ú©ò òß¶ transaction,
     //·®ò úÂ§ò† Âõ†ò £ú ´û§ original request_save, £Ê§¶§ ß¶¨
     //õ‚§ °·§ú† begin-abort-end transaction
     //sososo please check logic with err indicator !
     //°ò¢úÂ´ò† òßÊ:1.private.Transaction_Bmove_Update_Gmove ´û™ oDo_GL_Maintainance
     //               û ¶ß¶Âò £ú ´û§ ©ú†®· ´û™ °ò¢úÂ´ò† òß¶ ´û§ request_save ´¶¨ bmove.dd
     Procedure Request_Save_No_Transaction
               Integer liDo_Change_Garticl liTrexe_Result

               Forward Send Request_Save

               If (Not(Err));
                    Begin //ú≠'Ê©¶§ ´¶ garticl record ©Èüû°ú °ò§¶§†°·, ß®¶Æ‡®·‡ ©´û§ bpo
                     Get piDo_Change_Garticl to liDo_Change_Garticl
                     Get Trexe of liDo_Change_Garticl (Self) to liTrexe_Result

                     If (liTrexe_Result <> 0);
                        Begin //ú≠'Ê©¶§ û bpo õ‚§ ‚´®ú•ú ©‡©´·, ò°¨®È§‡ ´¶ transaction
                         //£ûõú§†©£Ê™ properties ö†ò úßÊ£ú§û °Â§û©û
                         Send private.Initialize_Properties
                         Indicate Err False
                         Procedure_Return
                        End
                     //úßò§ò≠¶®· ´¶¨ system indicator err
                     Indicate Err False
                    End

               Else Begin //ú≠'Ê©¶§ ´¶ Gmove record õ‚§ ©Èüû°ú, ò°¨®È§‡ ´¶ transaction
                     Send private.Initialize_Properties
                     Procedure_Return
                    End

             //ú≠'Ê©¶§ °ò† ´¶ garticl record ©Èüû°ú °ò§¶§†°·,
             //°ò† û bpo ‚´®ú•ú Æ‡®Â™ error,  °ò´òÆ‡®È ´¶ transaction
             //£ûõú§†©£Ê™ properties ö†ò úßÊ£ú§û °Â§û©û
             Send private.Initialize_Properties
             //úßò§ò≠¶®· ´¶¨ system indicator err
             //?????Indicate Err False
    End_Procedure   // request_save_no_transaction



//------------------------------------------------------START OF DEO REQUIRED FUNCTIONS

    Procedure pFindIsotimia String  Curr_Code##;
                            Date    ldArticle_Date##
                            Integer liModeF57##

              Clear Rates
              Move Curr_Code##      to Rates.Currency_C_code
              Move ldArticle_Date## to Rates.Rates_Hmnia

              Find Eq Rates By Index.1 //currency_c_code+rates_hmnia

              If (Found = 0);
                   Begin //ú·§ õ‚§ ô®È †©¶´†£Âò
                    //If (gsC_Code0 = Curr_Code##);
                    //     Begin //ú·§ ´¶ §Ê£†©£ò úöö®ò≠„™ úÂ§ò† ´¶ Âõ†¶ £ú ´¶ °Á®†¶ §Ê£†©£ò Æ®„©ú‡™
                    //      Set Field_Changed_Value Field Garticl.Garticl_Rate0 to 1
                    //      //Set pnRateFind to 1
                    //     End
                   End
              Else Begin //ú·§ ô®È †©¶´†£Âò
                    //If (gsC_Code0 = Curr_Code##);
                    //     Begin //ú·§ ´¶ §Ê£†©£ò úöö®ò≠„™ úÂ§ò† ´¶ Âõ†¶ £ú ´¶ °Á®†¶ §Ê£†©£ò Æ®„©ú‡™
                    //      Set Field_Changed_Value Field Garticl.Garticl_Rate0 to 1
                    //      //Set pnRateFind to 1
                    //     End
                    //Else Begin //ú·§ ´¶ §Ê£†©£ò úöö®ò≠„™ ÉÑå úÂ§ò† ´¶ Âõ†¶ £ú ´¶ °Á®†¶ §Ê£†©£ò Æ®„©ú‡™
                    //      Set Field_Changed_Value Field Garticl.Garticl_Rate0 to Rates.Rates_Rate0
                    //      //Set pnRateFind to Rates.Rates_Rate0
                    //     End
                    End

              //if (liModeF57## eq 0 ) set Field_Changed_Value Field Garticl.Garticl_Rate0 to Rates.Rates_Rate0
    End_Procedure //pfindisotimia




    // fiValidateGarticlFields_iexit:

    Function fiCheckDate Integer liField ;
                         Date    ldArticle_Date;
                         Date    ldAllowedDateFrom ;
                         Date    ldAllowedDateTo ;
                         Integer liMode;
                         Integer liHmgio_X##;
                         Returns Integer

        Integer liReturnVal##

        Move 0 to liReturnVal##
        If (liMode = 1);
             Begin //mode 1 =?
              If (ldArticle_Date < ldAllowedDateFrom) Function_Return 127
              If (ldArticle_Date > ldAllowedDateTo  ) Function_Return 127
             End
        If (liMode = 2);
             Begin //mode 2 = ?
              If (ldArticle_Date < ldAllowedDateFrom) Move 127 to liReturnVal##
              If (ldArticle_Date > ldAllowedDateTo  ) Move 127 to liReturnVal##
             End
//telika pia i diafora mode 1 kai 2 ?
        Function_Return liReturnVal##
    End_Function //fiCheckDate


    Function fiValidateGarticlFields_iExit Integer liField##;
                                           String lsFieldvalue##;
                                           Returns Integer
        Integer iReturnVal
function_return 0 //sososososo
        Date    ldAllowedDateFrom## //=Year_OpenFrom+Year.Year_DateAA
        Date    ldAllowedDateTo##   //=Year_OpenTo
        Date    ldArticl_Hmnia##
        Date    ldDateAA##
        String  sName##
        Integer iMainFile## liReturnVal## liReturnValb## liHmgioCode_X##
        Number  lnGtypkin_Code## lnIsot##

        Get Main_File to iMainFile##
        Get_Attribute DF_FIELD_NAME of iMainFile## liField## to sName##

        //‚¢úöÆ¶™ û£ú®¶£û§Âò™ ·®ü®¶¨
        If (sName## = 'GARTICL_HMNIA');
             Begin
              Move (Trim(lsFieldvalue##)) to lsFieldvalue##
              Get Field_Current_Value of (Year_DD    (Self)) Field SysCurGL.Year_OpenFrom     to ldAllowedDateFrom##
              Get Field_Current_Value of (Year_DD    (Self)) Field SysCurGL.Year_OpenTo       to ldAllowedDateTo##
              Get Field_Current_Value of (GThHmgio_DD(Self)) Field GThHmgio.GthHmgio_Code to liHmgioCode_X##

              Move (fiCheckDate(self,liField##,;
                                     lsFieldvalue##,;
                                     ldAllowedDateFrom##,;
                                     ldAllowedDateTo##,;
                                     1,;
                                     liHmgioCode_X##);
                               ) to liReturnVal##
              If (liReturnval## <> 0);
                   Begin
                    Error 127 " Invalid Date !!!!!"
                    Function_return 127
                   End

              Get Field_Current_Value of (Year_DD(Self)) Field Year.Year_DateAA to ldAllowedDateFrom##
              Move (fiCheckDate(Self,liField##,;
                                     lsFieldvalue##,;
                                     ldAllowedDateFrom##,;
                                     ldAllowedDateTo##,;
                                     2,;
                                     liHmgioCode_X##);
                               ) to liReturnVal##
              If (liReturnval## <> 0);
                   Begin
                     Error 127 " Invalid Date !!!!!"
                     Function_return 127
                   End

             End

             //‚¢úöÆ¶™ §¶£Â©£ò´¶™ úöö®ò≠„™
             If (sName## = 'GARTICL_C_CODE2');
                  Begin
                   Move (trim(lsFieldvalue##)) to lsFieldvalue##
                   Get Field_Current_Value Field Garticl.Garticl_Hmnia  to ldArticl_Hmnia##
                   Get Field_Current_Value Field Garticl.Garticl_Rate0  to lnIsot##
                   If (lnIsot## = 0 ) Send pFindIsotimia lsFieldValue## ldArticl_Hmnia## 0
                  End

             Move 0 to iReturnVal

             Function_Return iReturnVal
    End_Function // fiValidateGarticlFields_iexit
//------------------------------------------------------END OF DEO REQUIRED FUNCTIONS






    // Define_Fields:
    // This procedure is used to set up all data-dictionary rules.

    Procedure Define_Fields
        Forward Send Define_Fields
        //DDB-Generated-Code-Location
        //DDB-DefineFieldStart

        Set Main_File            To Garticl.File_Number
        Set Cascade_Delete_State To FALSE


        // Child (Client) file structure................
        Send Add_Client_File  Gmove.File_Number
        Send Add_Client_File  Gmovea.File_Number

        // Parent (Server) file structure...............
        Send Add_Server_File  Gtypkin.File_Number

        // External (System) file structure.............
        Send Add_System_File  Gthaa.File_Number  DD_LOCK_ON_SAVE
        Send Add_System_File  Sysrecg.File_Number  DD_LOCK_ON_NEW_SAVE
        Send Add_System_File  Gbridgeh.File_Number  DD_LOCK_ON_DELETE
        Send Add_System_File  Gbridged.File_Number  DD_LOCK_ON_DELETE
        Send Add_System_File  Barticl.File_Number  DD_LOCK_ON_DELETE
        Send Add_System_File  Particle.File_Number  DD_LOCK_ON_DELETE

        Define_Auto_Increment  Sysrecg.Garticle_Rec0  To Garticl.Garticl_Rec0

        // Field-based properties.......................

        // Garticl.Company_Code
        //DDB/ Comment_Short       Field Garticl.Company_Code To "Ñ§û£ú®È§ú´ò† ©´û§ Update"

        // Garticl.Branch_Code
        //DDB/ Comment_Short       Field Garticl.Branch_Code To "Ñ§û£ú®È§ú´ò† ©´û§ Update"

        // Garticl.Year_Year
        //DDB/ Comment_Short       Field Garticl.Year_Year To "Ñ§û£ú®È§ú´ò† ©´û§ Update"

        // Garticl.Gtypkin_Code
        //DDB/ Comment_Short       Field Garticl.Gtypkin_Code To "Ñ§û£ú®È§ú´ò† ©´û§ Update"

        // Garticl.Garticl_Hmnia
        //DDB/ Comment_Short       Field Garticl.Garticl_Hmnia To "Ñ§û£ú®È§ú´ò† ©´û§ Update £Ê§¶§ ö†ò û£/ö†ò †©¶¢¶ö†©£¶Á & òß¶ö®ò≠„™"
        Set Field_Entry_msg        Field Garticl.Garticl_Hmnia To Shmera
        Set Field_Prompt_Object    Field Garticl.Garticl_Hmnia To (Garticl(Self))

        // Garticl.Garticl_No

        // Garticl.Garticl_Rec0

        // Garticl.Gtypkin_Recr

        // Garticl.Gthhmgio_Code
        //DDB/ Comment_Short       Field Garticl.Gthhmgio_Code To "Ñ§û£ú®È§ú´ò† ©´û§ Update"

        // Garticl.Garticl_Recr
        Set Field_Prompt_Object    Field Garticl.Garticl_Recr To (Garticl(Self))

        // Garticl.Garticl_Aa

        // Garticl.Garticl_Aitiol
        Set Field_Value_Table      Field Garticl.Garticl_Aitiol To (Garticl_Garticl_A_Code_VT(Self))

        // Garticl.Garticl_C_Code2
        Set Field_Value_Table      Field Garticl.Garticl_C_Code2 To (Garticl_Garticl_C_Code2_VT(Self))

        // Garticl.Garticl_Rate0
        //DDB/ Comment_Short       Field Garticl.Garticl_Rate0 To "Ñ§û£ú®È§ú´ò† ©´û§ Update if not  User Inputed"

        // Garticl.Garticl_Rate00
        //DDB/ Comment_Short       Field Garticl.Garticl_Rate00 To "Ñ§û£ú®È§ú´ò† ©´û§ Update if not  User Inputed"

        // Garticl.Garticl_Rater
        //DDB/ Comment_Short       Field Garticl.Garticl_Rater To "Ñ§û£ú®È§ú´ò† ©´û§ Update if not  User Inputed"

        // Garticl.Garticl_Statuse
        //DDB/ Comment_Short       Field Garticl.Garticl_Statuse To "Ñ§û£ú®È§ú´ò† ©´û§ Update"
        Set Field_Value_Table      Field Garticl.Garticl_Statuse To (Garticl_Garticl_Statuse_VT(Self))

        // Garticl.Garticl_Statusa

        // Garticl.Garticl_M_Code
        //DDB/ Comment_Short       Field Garticl.Garticl_M_Code To "Module Ñöö®ò≠„™"
        Set Field_Value_Table      Field Garticl.Garticl_M_Code To (Garticl_Garticl_M_Code_VT(Self))

        // Garticl.Garticl_Sx0

        // Garticl.Garticl_Sp0

        // Garticl.Garticl_Syp0

        // Garticl.Garticl_Syp0k

        // Garticl.Garticl_Sx00

        // Garticl.Garticl_Sp00

        // Garticl.Garticl_Syp00

        // Garticl.Garticl_Syp00k

        // Garticl.Garticl_Sx1

        // Garticl.Garticl_Sp1

        // Garticl.Garticl_Sx2

        // Garticl.Garticl_Sp2

        // Garticl.Garticl_Syp2

        // Garticl.Garticl_Sxr

        // Garticl.Garticl_Spr

        // Garticl.Garticl_Sypr

        // Garticl.Garticl_Syprk

        // Garticl.Garticl_Xreline

        // Garticl.Garticl_Pisline

        // Garticl.Garticl_Inc

        // Garticl.Gartcl_Exp

        // Garticl.Garticl_Cash

        // Garticl.Garticl_Omada

        // Garticl.Garticl_Other

        // Garticl.Garticl_Mlines

        // Garticl.Garticl_Myfvalp

        // Garticl.Garticl_Myfcodp

        // Garticl.Garticl_Myfnump
        //DDB/ Comment_Short       Field Garticl.Garticl_Myfnump To "Ñ§û£ú®È§ú´ò† ©´û§ Update"

        // Garticl.Garticl_Myfchkp

        // Garticl.Garticl_Myfvala

        // Garticl.Garticl_Myfcoda

        // Garticl.Garticl_Myfnuma
        //DDB/ Comment_Short       Field Garticl.Garticl_Myfnuma To "Ñ§û£ú®È§ú´ò† ©´û§ Update"

        // Garticl.Garticl_Myfchka

        // Garticl.Apo_Gbridge

        //DDB-DefineFieldEnd
    End_Procedure    // Define_Fields

    // Field_Defaults:
    // This procedure is used to establish default field values.

    Procedure Field_Defaults
        Forward Send Field_Defaults
        //DDB-Generated-Code-Location
        //DDB-FieldDefaultStart
        Set Field_Changed_Value   Field Garticl.Garticl_C_Code2 To "EUR"
        Set Field_Changed_Value   Field Garticl.Garticl_Statuse To -1
        Set Field_Changed_Value   Field Garticl.Garticl_Statusa To 0
        //DDB-FieldDefaultEnd
    End_Procedure    // Field_Defaults
End_Class    // Garticle_DataDictionary



Use doCngGar.bp //defines business process oDoChangeKin

///////////////If ((Gtypkin.Gtypkin_Code ne Garticl.Gtypkin_Code) and (Current_Record(Srv##) ne 0)) Send Operation_Not_Allowedmove 129
//                send pFindIsotimia Garticl.Garticl_C_Code2 Garticl.Garticl_Hmnia 0

//           if Garticl.Garticl_AA gt 0 move 131 to iReturnVal SOS!!!
//            move (fiValidateCheck_Save(self)) to iReturnVal



//  Procedure Request_Save0
//            Integer libpo_02
//            Number lnRateBF lnRateAF
//            String lsCurrBF lsCurrAF
//
//            Forward Send Request_Save
//
//            Get psCurrBF to lsCurrBF
//            Get pnRateBF to lnRateBF
//
//            Get psCurrAF to lsCurrAF
//            Get pnRateAF to lnRateAF
//
//
//            If (;
//                 (lnRateBF <> lnRateAF) or;
//                 (lsCurrBF <> lsCurrAF);
//                ) Begin
//                   Move (oDoChangeKin(Self)) to liBpo_02
//                   Send Change_Gtypkin_Code  to liBpo_02 lsCurrAF lnRateAF Garticl.Recnum
//                  End
//
//            Set psCurrBF to ""
//            Set pnRateBF to 0
//
//            Set psCurrAF to ""
//            Set pnRateAF to 0
//
//            Set pnRateFind to 0
//  End_Procedure   // Request_Save0



//  Procedure Destroying0 //£·¢¢¶§ õ‚§ Æ®ú†·ùú´ò†, õ†Ê´† û creating ´¶ °·§ú† òß¶ £Ê§û ´û™
//         Forward Send  Destroying
//        //************************************************************************
//        //flag 5:ò¨´Ê£ò´û ò®Âü£û©û                                               *
//        //************************************************************************
//        If (Gtypkin.Gtypkin_Flags Contains "-5-");
//             Begin //´¶ ·®ü®¶ ‚Æú† ò¨´Ê£ò´û ò®Âü£û©û
//              Set piA_Flag05 to TRUE
//              Sub 1 to Gtypkin.Gtypkin_L_No
//             End
//        Else Begin //´¶ ·®ü®¶ ‚Æú† Æú†®¶°Â§û´û ò®Âü£û©û
//              Set piA_Flag05 to FALSE
//             End
//  End_Procedure //Destroying0



//    Function fiValidateCheck_Save  Returns Integer
//        Local Integer iReturnVal
//
//                 if Garticl.Garticl_Hmnia   lt Year.Year_XrhshFrom Function_Return 131
//            else if Garticl.Garticl_Hmnia   lt Year.Year_XrhshTo   Function_Return 131
//            else if Garticl.Garticl_Hmnia   eq ""                  move 128 to ireturnVal
//            else if Garticl.Garticl_Hmnia   lt Year.Year_DateAA    move 128 to ireturnVal //For Timologhsh
//            else if Gtypkin.Gtypkin_Code    eq 0                   move 128 to ireturnVal //Gtypkin
//            else if Garticl.Garticl_C_Code2 eq ""                  move 128 to ireturnVal //Currency
//            else if Garticl.Garticl_Rate0   eq 0                   move 128 to ireturnVal //Isotimia
//
//        Function_Return iReturnVal
//    End_Function

////Procedure Set_ZeroAA Integer liStatusAA##
////////Set piZeroAA to liStatusAA##
////End_Procedure //set_zeroaa




//DDB-Selection-pkg-Start
#IFDEF Is$WebApp
#ELSE

Use Garticl.SL       // Garticl

#ENDIF
//DDB-Selection-pkg-End
//DDB-FileEnd
